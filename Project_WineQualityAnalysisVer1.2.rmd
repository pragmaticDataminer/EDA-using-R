---
title: "Wine Quality Analysis"
author: "Kusum Anand"
date: May 31, 2018
output:
  html_document:
    toc: true
    toc_depth: 3
    toc_float: true
---


# Abstract

With globalization,increased connectivity and globetrotting, wine drinking has surely taken off especially in non traditional wine drinking market,wine is easily accessible off the supermarket shelves.That being said, the average consumer would want an affordable wine that is easy on the palate.However for a wine connoisseur, fine wine quality brings diversity, attributed to sensory perceptions formed by complex interactions of the compounds in the wine making process. As the Latin phrase goes,"In vino veritas" meaning "in wine there is truth" , we shall explore the red and white wine datasets to understand how  their physicochemical properties influence the 'objective' quality of wine.


# Introduction
The red and white wine sample datasets consists of inputs from objective tests (e.g. PH values) and the output is based on sensory data(median of at least 3 evaluations made by wine experts). Each expert has graded the wine quality between 0 (very bad) and 10 (very excellent). We shall analyse what constitutes the nature of the wine to be graded on quality.

The two datasets are related to red and white variants of the Portuguese "Vinho Verde" wine.For more details, visit: http://www.vinhoverde.pt/en/ or the reference [Cortez et al., 2009].Due to privacy and logistic issues, only physicochemical (inputs) and sensory (the output) variables are available (e.g. there is no data about grape types, wine brand, wine selling price, etc.The quality of the wine has been rated with values ranging from 0 (very bad) to 10 (very excellent).

Input variables (based on physicochemical tests):

1. fixed acidity (tartaric acid - g / dm^3)
2. volatile acidity (acetic acid - g / dm^3)
3. citric acid (g / dm^3)
4. residual sugar (g / dm^3)
5. chlorides (sodium chloride - g / dm^3
6. free sulfur dioxide (mg / dm^3)
7. total sulfur dioxide (mg / dm^3)
8. density (g / cm^3)
9. pH
10. sulphates (potassium sulphate - g / dm3)
11. alcohol (% by volume)


Output variable (based on sensory data): 

12. quality (score between 0 and 10)


The wine data will be analysed from an 'objective quality' perspective,  understand how the physicochemical properties of the wine influence the perception of quality of the wine.This report analyses both red and white wine datasets and how the two differ in terms of quality based on the same set of properties.


# Data Exploration
Note that the dataset is in tidy format rendering them ready to manipulate and visualize.Lets begin by loading in the required libraries and  the data set.

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}

# Load the library
suppressMessages(library(readxl)) # read and write xls,xlxs,csv,tsc,formats
suppressMessages(library(lattice)) # visualize data(esp.multivariate)
suppressMessages(library(MASS)) # applied stats
suppressMessages(library(ggplot2)) # visualize data
suppressMessages(library(tidyr)) # change the layout of data sets
suppressMessages(library(dplyr)) # create  summaries and transmissions.
suppressMessages(library(scales)) # auto rendering of breaks and labels for axes and lengends
suppressMessages(library(psych)) # factor analysis
suppressMessages(library(reshape)) # reshape and wrangle data
suppressMessages(library(memisc)) # to summarize the regression
suppressMessages(library(gridExtra)) # building grid plots
suppressMessages(library(corrplot)) # Plot correlation coefficient.

```


```{r echo=FALSE, Load_the_Data}

# read in the files and check top few records and column labels.
red_wine <- read.csv("wineQualityReds.csv")
head(red_wine, 3)
cat("\n\n") # line spacing
white_wine <- read.csv("wineQualityWhites.csv")
head(white_wine, 3)

# Check the structure of the dataframe. The columns are numeric
cat("\n\n")
str(red_wine)
cat("\n\n")
str(white_wine)

# column names are same
names(red_wine) == names(white_wine)

# View the dimensions of the dataframe.
dim(red_wine)
dim(white_wine)

# white_wine(count=4898) has more nows than red_wine(count=1599) dataset.For a balanced comparison, white wine will be sampled to make the count equal to that of red wine data.

set.seed(42)
sample.white_wine <- sample(white_wine, 1599)
str(sample.white_wine)

white_wine <- sample.white_wine

# Cross check to confirm.
dim(red_wine) == dim(white_wine)


# combine the two data sets.Before combining the datasets,for each of the dataset add marker to identify red and white 'wine type' by introducing wine.type column.

color <- rep("red", dim(red_wine)[1])
red_wine$wine.type <- color

color <- rep("white", dim(white_wine)[1])
white_wine$wine.type <- color


# stack the two dataframes
wine_quality <- rbind(red_wine, white_wine)

# Omit the first column referring to row number.
wine_quality <- subset(wine_quality, select=-c(X))

# check the structure.
str(wine_quality)

# categorise the wine type variable using factor
wine_quality$wine.type <- factor(wine_quality$wine.type)
# is.factor(wine_quality$wine.type)
names(wine_quality)

```

# Univariate Plots 

```{r echo=FALSE, message=FALSE, warning=FALSE, Univariate_Plots}
# Melt the multiple columns/attributes into two: columns and values.Columns 1 to 12 will be collapsed to match the property  and its values against the wine type.

wine_quality_gthr <- gather(wine_quality, "columns", "values", 1:12)
head(wine_quality_gthr)

str(wine_quality_gthr)

```


```{r echo=FALSE, message=FALSE, warning=FALSE}

ggplot(wine_quality_gthr, aes(values, color = "black")) +
  geom_histogram(fill = "green") +
  facet_wrap(~ columns, scales = "free") +
  theme_update(plot.title = element_text(hjust = 0.5)) +
  ggtitle("Distribution of wine attributes") +
  theme(legend.position = "none")

```


```{r echo=FALSE, message=FALSE, warning=FALSE, descriptive_statistics}

describe(wine_quality)

```
### Observations from the distribution of variables

1. The output variable 'quality' has highest number of wine samples concentrated around rating of 6. Mean and median values are very close making the distribution near normal.The least quality rating is 3 while the best quality rating is 9.
2. Highly positively skewed variables(where skewness is < -1 or > 1): residual.sugar,chlorides,free.sulfur.dioxide  and sulphates. The remaining variables are approximately  normally distributed.
3. Density has negative skewness showing left skewed distribution.
4. Kurtosis for chlorides,residual.sugar,free.sulfur.dioxide and sulphates is high. Kurtosis measures the tail-heaviness of the distribution and indicates the presence of outliers.Total.sulfur.dioxide,density and alcohol have negative kurtosis indicating lighter tails. 

Let us now look at individual properties' effect on the wine types.


```{r echo=FALSE, message=FALSE, warning=FALSE, volatile_acidity}

grid.arrange(
  ggplot(wine_quality, aes(
  x = "",
  y = volatile.acidity, fill = wine.type
  )) +
  geom_jitter(alpha = 0.1) +
  geom_boxplot(alpha = 0.1, color = "red"),
  ggplot(wine_quality, aes(volatile.acidity, fill = wine.type)) +
  geom_histogram(position = "identity", alpha = 0.5) +
  coord_cartesian(xlim = c(0, 1.2)),
  ncol = 2
)

```


```{r echo=FALSE, message=FALSE, warning=FALSE,summary_volatile_acidity}

by(wine_quality$volatile.acidity, wine_quality$wine.type, summary)

```


Voltile acidity is lower for white wine with more samples having < 0.75  (acetic acid - g / dm^3) with mean of around 0.5 while for red wine samples,greater number of samples are spread-out compared to white wine samples with mean of 0.277(acetic acid - g / dm^3).


```{r echo=FALSE, message=FALSE, warning=FALSE,residual_sugar}

grid.arrange(
  ggplot(wine_quality, aes(
  x = " ", y = residual.sugar, fill = wine.type
  )) +
  geom_jitter(alpha = 0.1) +
  geom_boxplot(alpha = 0.1, color = "red"),
  ggplot(wine_quality, aes(residual.sugar, fill = wine.type)) +
  geom_histogram(position = "identity", alpha = 0.5),
  ncol = 2
  )
  
```

```{r echo=FALSE, message=FALSE, warning=FALSE,summary_residual_sugar }

by(wine_quality$residual.sugar, wine_quality$wine.type, summary)

```

A large number of white wine samples have an increasing residual sugar(RS)  concentration across the RS scale with values  > 20  g / dm^3, where as red wine has very less residual sugar concentration for most samples under 2.5 g / dm^3 and the count of such samples rapidly decays.How would this stark difference  play out in terms of its interaction with other independent variables and the quality rating, will be quite significant.


```{r echo=FALSE, message=FALSE, warning=FALSE,citric.acid}

grid.arrange(
  ggplot(wine_quality, aes(
  x = " ", y = citric.acid, fill = wine.type
  )) +
  geom_jitter(alpha = 0.1) +
  geom_boxplot(alpha = 0.2, color = "red"),
  # scale_y_continuous(lim = c(0.3,1.6)),
  ggplot(wine_quality, aes(citric.acid, fill = wine.type)) +
  geom_histogram(position = "identity", alpha = 0.5) +
  coord_cartesian(xlim = c(0, 1)),
  ncol = 2
  )

```


```{r echo=FALSE, message=FALSE, warning=FALSE,summary_citric_acid }

by(wine_quality$citric.acid, wine_quality$wine.type, summary)

```


Median citric acid concentration is very high for  white wine samples with near normal distribution while the concentration is less for red wine sample.We see red wine samples  concentrated at < 0.25 citric acid (g / dm^3) with a right skewed distribution.


```{r echo=FALSE, message=FALSE, warning=FALSE, chlorides }

grid.arrange(
  ggplot(wine_quality, aes(
  x = "", y = chlorides, fill = wine.type
  )) +
  geom_jitter(alpha = 0.1) +
  geom_boxplot(alpha = 0.2, color = "red"),
  # scale_y_continuous(lim = c(0.3,1.6)),
  ggplot(wine_quality, aes(chlorides, fill = wine.type)) +
  geom_histogram(position = "identity", alpha = 0.5) +
  coord_cartesian(xlim = c(0, 0.3)),
  ncol = 2
  )
  
```


```{r echo=FALSE, message=FALSE, warning=FALSE,summary_chlorides }

by(wine_quality$chlorides, wine_quality$wine.type, summary)

```

Majority of White wine samples have lower chloride content with median at 0.0430 while red wine samples have comparatively greater chloride content(median = 0.0790). Overall wines have lower salt content.


```{r echo=FALSE, message=FALSE, warning=FALSE,free.sulfur.dioxide}

grid.arrange(
ggplot(
wine_quality,
aes(x = "", y = free.sulfur.dioxide, fill = wine.type)
) +
geom_jitter(alpha = 0.1) +
geom_boxplot(alpha = 0.1, color = "red"),
ggplot(wine_quality, aes(free.sulfur.dioxide, fill = wine.type)) +
geom_histogram(position = "identity", alpha = 0.5) +
coord_cartesian(xlim = c(0, 100)),
ncol = 2
)

```


```{r echo=FALSE, message=FALSE, warning=FALSE,summary: free.sulfur.dioxide }

by(wine_quality$free.sulfur.dioxide, wine_quality$wine.type, summary)

```


White wine samples have higher free sulfur di oxide concentration than red wine.Red wine samples seem to be concentrated under 25 mg / dm^3 with median value of 14.00 while white wine samples have median value of 33.00


```{r echo=FALSE, message=FALSE, warning=FALSE,total.sulfur.dioxide}

grid.arrange(
  ggplot(
  wine_quality,
  aes(x = "", y = total.sulfur.dioxide, fill = wine.type)
  ) +
  geom_jitter(alpha = 0.1) +
  geom_boxplot(alpha = 0.1, color = "red"),
  ggplot(wine_quality, aes(total.sulfur.dioxide, fill = wine.type)) +
  geom_histogram(position = "identity", alpha = 0.5),
  ncol = 2
  )

```


```{r echo=FALSE, message=FALSE, warning=FALSE,summary: total.sulfur.dioxide }

by(wine_quality$total.sulfur.dioxide, wine_quality$wine.type, summary)

```

Like free sulfur di oxide, total sulfur di oxide is more concentrated in white wine than red wine:red wine samples with median value of just 38 mg / dm^3 compared to 134 mg / dm^3 in white wine samples.

```{r echo=FALSE, message=FALSE, warning=FALSE,density}

grid.arrange(
  ggplot(wine_quality, aes(
  x = "", y = density, fill = wine.type
  )) +
  geom_jitter(alpha = 0.1) +
  geom_boxplot(alpha = 0.1, color = "red"),
  ggplot(wine_quality, aes(density, fill = wine.type)) +
  geom_histogram(position = "identity", alpha = 0.5),
  ncol = 2
  )

```


```{r echo=FALSE, message=FALSE, warning=FALSE,summary: density }

by(wine_quality$density, wine_quality$wine.type, summary)

```

Some of the white wine samples are less dense compared to red wine.Overall red wine samples have higher density.

```{r echo=FALSE, message=FALSE, warning=FALSE,sulphates}

grid.arrange(
  ggplot(wine_quality, aes(
  x = "", y = sulphates, fill = wine.type
  )) +
  geom_jitter(alpha = 0.1) +
  geom_boxplot(alpha = 0.1, color = "red"),
  ggplot(wine_quality, aes(sulphates, fill = wine.type)) +
  geom_histogram(position = "identity", alpha = 0.5),
  ncol = 2
  )
  
```

```{r echo=FALSE, message=FALSE, warning=FALSE,summary: sulphates }

by(wine_quality$sulphates, wine_quality$wine.type, summary)

```

Sulphates, Wine additives to produces SO2 is less in white wine compared to red, as we see that white wine already has higher SO2 levels.

```{r echo=FALSE, message=FALSE, warning=FALSE,pH }

grid.arrange(
  ggplot(wine_quality, aes(
  x = "", y = pH, fill = wine.type
  )) +
  geom_jitter(alpha = 0.1) +
  geom_boxplot(alpha = 0.1, color = "red"),
  ggplot(wine_quality, aes(pH, fill = wine.type)) +
  geom_histogram(position = "identity", alpha = 0.5),
  ncol = 2
  )

```

```{r echo=FALSE, message=FALSE, warning=FALSE,summary: pH }

by(wine_quality$pH, wine_quality$wine.type, summary)

```

Both the wines seem to have balanced pH levels ranging from around 3.1 - 3.4 (IQR)

```{r echo=FALSE, message=FALSE, warning=FALSE,alcohol}

grid.arrange(
  ggplot(wine_quality, aes(
    x = "", y = alcohol, fill = wine.type
  )) +
    geom_jitter(alpha = 0.1) +
    geom_boxplot(alpha = 0.1, color = "red"),
  ggplot(wine_quality, aes(alcohol, fill = wine.type)) +
    geom_histogram(position = "identity", alpha = 0.5),
  ncol = 2
)

```


```{r echo=FALSE, message=FALSE, warning=FALSE,summary: alcohol }

by(wine_quality$alcohol, wine_quality$wine.type, summary)

```

Both the wines have similar range of alcohol content.The dataset has more red wine samples below 11 % alcohol by volume.

```{r echo=FALSE, message=FALSE, warning=FALSE,quality }

grid.arrange(
  ggplot(wine_quality, aes(
  x = 1, y = quality, fill = wine.type
  )) +
  geom_jitter(alpha = 0.1) +
  geom_boxplot(alpha = 0.1, color = "red"),
  ggplot(wine_quality, aes(quality, fill = wine.type)) +
  geom_histogram(
  position = "dodge",
  alpha = 0.5,
  binwidth = .5
  ) +
  coord_cartesian(xlim = c(1, 9)),
  ncol = 2
  )
  
```


```{r echo=FALSE, message=FALSE, warning=FALSE,summary: quality}

by(wine_quality$quality, wine_quality$wine.type, summary)

```

The dataset has higher red wine samples of quality rating 5 and higher white wine samples of quality rating 6.

```{r echo=FALSE, message=FALSE, warning=FALSE,fixed.acidity }

grid.arrange(
  ggplot(wine_quality, aes(
  x = 1, y = fixed.acidity, fill = wine.type
  )) +
  geom_jitter(alpha = 0.1) +
  geom_boxplot(alpha = 0.1, color = "red"),
  ggplot(wine_quality, aes(fixed.acidity, fill = wine.type)) +
  geom_histogram(
  position = "identity",
  alpha = 0.5,
  binwidth = .5
  ) +
  coord_cartesian(xlim = c(1, 9)),
  ncol = 2
)

```


```{r echo=FALSE, message=FALSE, warning=FALSE,summary: fixed.acidity}

by(wine_quality$fixed.acidity, wine_quality$wine.type, summary)

```

Red wine has higher fixed acidity concentration than white wine.


# Univariate Analysis

### Structure of dataset

Two datasets:red and white wine sample datasets have been considered for wine analysis. White wine dataset has 4898 observations while red wine dataset has 1599 observations.In order to have reasonable comparison,white wine dataset has been sampled to have the same number of observations as that of red wine.The attributes of both the samples have 11 physicochemical properties which are the independent vatriables and quality as the output / dependent variable.The independent variables are of class numeric while dependent variable is of class integer.

### Main feature(s) of interest

The main feature of interest is the dependent variable, quality and how the physiochemicl attributes influence the response variable. 
The visualization under univariate plots, indicates that there is a  higher concentration of wines with  5 and 6 quality rating.This is confirmed in the description section referring to higher samples of normal wine rather than poor and excellent wine.

### Other features of interest

At this point,all the physiochemical properties considered in the dataset are important.We shall analyse how each of the properties directly or indirectly affect each other and ultimately influence the 'objective' quality of wine.Point to note : quality per description is evaluated from a sensory perception.The information provided in the description about the properties validates this understanding, until further analysis to rule out or consider primary features of interest.Each feature plays a role in the winemaking process.Few such instances:

The pH plot shows near normal distribution with mean and median at 3.25 and 3.24 and the pH values are maintained at 3-4 range, indicating acid balance needed to provide wine stability and for the effectiveness of sulfur dioxide.

Wine inherently contains sweetness and acidity.Some of the sugar gets transformed to alcohol during fermentation.

Sulphates, as an additive produces sulphur di oxide,some of which is naturally present in wines.Free sulphur di oxide,a component of total sulphur di oxide is essential to prevent bacterial activity.The amount depends on the level of acidity and residual sugar to balance acidity and sweetness respectively.

### New variables from existing variables in the dataset and other changes.

Since two datasets have been stacked, a new variable,wine.type has been created and factorized.
As we progress in our investigation we shall create newer variables based on the findings.

The dataset is available in tidy format making it easier for immediate visualization and manipulation.white_wine(4898) has more observations than red_wine(1599) dataset.For a balanced comparison, white wine has been sampled to make the count equal to that of red wine data.


# Bivariate Plots

Below is the plot of correlation of the features.

```{r echo=FALSE, message=FALSE, warning=FALSE, Correlation_of_Attributes }

col <- colorRampPalette(c(
  "#7F0000", "red", "#FF7F00", "#7FFF7F",
  "magenta", "#007FFF", "blue", "#00007F"
))

corrplot(
  cor(wine_quality[, 1:12]),
  method = "number",
  col = col(12),
  tl.col = "black",
  tl.srt = 45,
  type='upper',
  title = "Correlation of Attributes",
  mar = c(0, 0, 1, 0),
  number.cex = 7 / ncol(wine_quality[, 1:12]),
  tl.cex = 0.8
)

```


## Observations

Summary of the relationship between independent variables and the correlation between response - independent variable.

1. The corrplot shows positive correlation between the response variable - wine quality and the following predictors :citric acid,free sulphur di oxide,pH,sulphates and alcohol.Alcohol has the highest correlation with quality at 0.46.

2. Quality - residual sugar have correlation coefficient at zero ie no linear relationship between the two.

3. Negative correlation is shared with fixed acidity,volatile acidity,chlorides,total sulphur di oxide,density and pH.Quality improves with decrease in these factors.

4. Alcohol is positively correlated with citric acid, pH and sulphates while negatively correlated with remaining properties.

5. Sulphates have positive correlation with fixed and volatile acidity,citric acid,chlorides,pH.Sulphates are additives added to wine which contribute to sulfur dioxide gas.

6. pH positively correlates with voltile acidity,chlorides,sulpahtes and alcohol maintaining acid-base balance.

7. Free sulfur dioxide - part of total sulfur dioxide is essential for wine to prevent microbial and oxidation of wine.

8. Density has negative correlation with free sulphur di oxide,total sulphur di oxide,alcohol and quality, the remaining properties have positive correlation.

9. Citric acid in small quantities adds freshness and flavour to wine and understandably negatively correlates to pH,alcohol and volatile acidity.

10. Interestingling residual sugar has correlation coefficent of 0 with quality.Per information provided about residual sugar,'it's rare to find wines with less than 1 gram/liter and wines with greater than 45 grams/liter are considered sweet' which means there will be some amount of residual sugar present in wines (and these can be balanced by acidity).



### categorize the 'quality' variable

```{r echo=FALSE, message=FALSE, warning=FALSE}

wine_quality$f1_quality <- factor(wine_quality$quality)
table(wine_quality$f1_quality)

```


```{r echo=FALSE, message=FALSE, warning=FALSE}

ggplot(wine_quality, aes(fill = f1_quality, x = wine.type)) +
  geom_bar(position = "dodge") +
  coord_cartesian(ylim = c(0, 675))+
  scale_fill_brewer(palette = 'Reds', guide = guide_legend(title = "Quality ratings")) +
       theme_dark()

```

We see a large number of white wine samples of quality rating 6 followed by 5 while red wine samples have higher count  of quality rating 5 followed by 6.

Plotting quality as a factor against other independent varaiables -
x <- names(select(wine_quality,fixed.acidity,volatile.acidity,citric.acid,residual.sugar))
x


```{r echo=FALSE, message=FALSE, warning=FALSE,bivariate_plots1}

bivar <- function(data,
                  y,
                  x = "f1_quality",
                  lower_v = 0.1,
                  upper_v = 0.99) {
                  ggplot(data, aes_string(x = x, y = y, fill = x)) +
                  geom_jitter(alpha = 0.5,
                  color = "orange",
                  size = .01) +
                  geom_boxplot(alpha = 0.2, color = 'brown') +
                  ylim(quantile(data$y, probs = lower_v),
                  quantile(data$y, probs = upper_v)) +
                  theme(legend.position = "none")
                  }
                  
                  pb1 <-
                  Lapply(
                  names(
                  select(
                  wine_quality,
                  fixed.acidity,
                  volatile.acidity,
                  citric.acid,
                  residual.sugar
                  )
                  ),
                  FUN = function(columns)
                  bivar(wine_quality, columns)
                  )
                  pb2 <-
                  Lapply(
                  names(
                  select(
                  wine_quality,
                  chlorides,
                  free.sulfur.dioxide,
                  total.sulfur.dioxide,
                  density
                  )
                  ),
                  FUN = function(columns)
                  bivar(wine_quality, columns)
                  )
                  pb3 <-
                  Lapply(
                  names(select(wine_quality, pH, sulphates, alcohol)),
                  FUN = function(columns)
                  bivar(wine_quality, columns)
                  )
                  
                  do.call(grid.arrange, args = c(pb1, list(ncol = 2)))
                  
```

Fixed acidity -  Fixed acidty(tartaric acid - g / dm^3) doesnt seem to impact quality as the value is flat for the quality levels. This should be expected as the description says,'most acids involved with wine are fixed or nonvolatile'. The word fixed would indicate that there will be some acidity and this 'some' is around 7.2 g / dm^3 (median)

Voltile acidity - Volatile acidity(acetic acid - g / dm^3) drops  with increase in quality and stabilizes at Q-7.
This concurs with the point ' too high levels can lead to an unpleasant, vinegar taste'.
Volatile acidity affects quality and it should be on the lower side.Excess volatile acidity is contained by sulphur di oxide and citric acid as these share negative correlation.

Citric acid - We can see a marginal increase in citric acid levels at higher quality levels. It is required in small quantities to add 'freshness' and flavor to wines.Citric acid has mild effect(increasing) at increasing quality levels.

Residual sugar - There will be some amount of residual sugar after fermentation.We see a stable level of residual sugar only to jump at Q-8 and fall slightly.There is negligible to no effect on quality.Residual sugar is balanced by acids,chlorides,pH and alcohol.



```{r echo=FALSE, message=FALSE, warning=FALSE,bivariate_plots2}

do.call(grid.arrange, args = c(pb2, list(ncol = 2)))

```

Chlorides - Salt content drops at increasing  quality ratings.Chlorides affect quality,hence needs to be balanced.

Free sulphur di oxide - Free sulphur di oxide is needed to prevent microbial growth and the oxidation of wine.Free sulphur di oxide concentration increases with quality ratings. Free sulphur di oxide affects quality positively.

Total sulphur di oxide  - Free sulphur di oxide  constitutes part of total sulphur di oxide . Total sulphur di oxide level increase from Q-3 to Q-5, wobbles marginally and increases from Q-6 to Q-9.

Density - Density drops at higer quality ratings.Density depends on alcohol and sugar content.
Then at higher quality ratings we should expect moderate sugar and high alcohol content.
Density is positively correlated to sugar where as negatively correlated to alcohol.


```{r echo=FALSE, message=FALSE, warning=FALSE,bivariate_plots3}

do.call(grid.arrange, args = c(pb3, list(ncol = 2)))

```

pH drops marginally from Q-4 to Q-5 and stabilizes.There is a slight increase at Q-9, considering Q-9 has only 2 samples, we can consider that a stable pH at 3.25 -3.3 is maintained at increasing quality levels.pH is required to maintain stability and effectiveness of SO2(sulpur di oxide) .

Alcohol - We see an increasing alcohol content at higher quality ratings from Q-5 onwards, though we see a slight fall in alcohol median value from Q-3 to Q-5.

Sulphates - There is a marginal linear increase in sulphate content with increasing quality ratings.There is a drop at Q-9.Q-9 has only two data points.

### Summary - Quality vs supporting properties of wine.

We see that alcohol deeply affects quality along with the following:
sulphates (contributes to  total sulphur di oxide ), total sulphur di oxide and includes free sulphur dioxide.
volatile acidity and citric acid.
Residual sugar and quality have correlation coeffient of 0.Does sweetness or the lack of it affect quality needs to be investigated.

The quality parameter will be reduced to three levels -
1. Low - Q-3,Q-4
2. Avg - Q-5,Q-6
3. High - Q-7,Q-8,Q-9

Q-9 has just two records.Instead of creating another level, will be considered under High.

```{r echo=FALSE, message=FALSE, warning=FALSE,L1}

wine_quality$f2_quality <- ifelse(
  wine_quality$quality == 3 |
  wine_quality$quality == 4,
  "Low",
  ifelse(
  wine_quality$quality == 5 |
  wine_quality$quality == 6,
  "Avg",
  "High"
  )
  )
  
  wine_quality$f2_quality <-
  factor(wine_quality$f2_quality, levels = c("Low", "Avg", "High"))
  
```


Alcohol being highly correlated with quality, we shall plot the %alcohol distribution by quality.


```{r echo=FALSE, message=FALSE, warning=FALSE,L2}

ggplot(wine_quality, aes(alcohol, fill = f2_quality)) +
  geom_bar(position = "dodge",binwidth = 1) +
  facet_wrap( ~ wine.type)+
  xlab('alcohol (% by volume)')+
  scale_fill_brewer(palette = 'Reds')+
  theme_dark()

```

Average quality wine samples under both red and white are large in numbers.Wines with Average quality rating are available at higher alcohol levels(alcohol % by volume): 8 through 14.Though there is a decreasing trend for 'Avg' quality rating.

High Quality rating is available from alcohol level of 9% ,with linear increase till 12% and then decays.12% seem to be highest level of alcohol content for 'High' quality.

Low quality rating is found under alcohol level of 13 starting from around 9 peaking at 10 and the declines, nonetheless alcohol at 9 through 12 have 'High' quality rating.

Applying the second level quality factor to other properties:



```{r echo=FALSE, message=FALSE, warning=FALSE}

bivar_quality <-
  function(data,
  y,
  x = "f2_quality",
  lower = .1,
  upper = .99) {
  ggplot(data, aes_string(x = x, y = y, fill = x)) +
  geom_jitter(alpha = 0.5,
  color = "orange",
  size = .01) +
  geom_boxplot(alpha = 0.2, color = 'brown') +
  ylim(quantile(data$y, prob = lower),
  quantile(data$y, prob = upper)) +
  theme(legend.position = "none")
  }
  pq1 <-
  lapply(
  names(
  select(
  wine_quality,
  fixed.acidity,
  volatile.acidity,
  citric.acid,
  residual.sugar
  )
  ),
  FUN = function(columns)
  bivar_quality(wine_quality, columns)
  )
  pq2 <-
  lapply(
  names(
  select(
  wine_quality,
  chlorides,
  free.sulfur.dioxide,
  total.sulfur.dioxide,
  density
  )
  ),
  FUN = function(columns)
  bivar_quality(wine_quality, columns)
  )
  pq3 <-
  lapply(
  names(select(wine_quality, pH, sulphates, alcohol)),
  FUN = function(columns)
  bivar_quality(wine_quality, columns)
  )
  
  do.call(grid.arrange, args = c(pq1, list(ncol = 2)))
  
```

Fixed acidity and residual sugar seem to be maintained at a constant level.

Citric acid increases linearly with quality:it provides freshness to the beverage.

volatile acidity has a downward trend as quality improves:excess results in sourness.

There is negligible increase in residual sugar content  with increase in quality.


```{r echo=FALSE, message=FALSE, warning=FALSE,ql}

do.call(grid.arrange, args = c(pq2, list(ncol = 2)))

```


From Low to Avg quality there is marginal increase in the chlorides and then we see a slight drop in the High quality rating.

free sulphur di oxide is a component of total sulphur di oxide  and both increase with increase in quality.

From Low to Avg quality there is marginal increase in the density and then we see a  drop in density for High quality rating.


```{r echo=FALSE, message=FALSE, warning=FALSE, PROP_QUAL}

do.call(grid.arrange, args = c(pq3, list(ncol = 2)))

```


pH level slightly drops at Avg and remains fairly flat at High.
Sulphate levels  increase maginally with increase in quality.
Alcohol level is high in high quality wines compared to low and avg quality wines.


### Impact of residual sugar on quality

We have seen that residual sugar and quality have correlation coeffient of 0.Then does sweetness or the lack of it affect quality.Lets group the sugar levels using summary details and create a category of sugar levels.


```{r echo=FALSE, message=FALSE, warning=FALSE, group_sugar_levels}

# group the sugar levels

summary(wine_quality$residual.sugar)

# use summary as base to categorise the sugar level.

wine_quality$sugar.level <-
cut(wine_quality$residual.sugar,
c(0.600, 1.900, 2.400, 5.700, 22.600))

table(wine_quality$sugar.level)
levels(wine_quality$sugar.level)

# use factor function
wine_quality$f1.sugar.level <-
factor(
wine_quality$sugar.level,
labels = c("L", "M", "H", "V.H"),
ordered = T
)
levels(wine_quality$f1.sugar.level)
summary(wine_quality$f1.sugar.level)
# subset(wine_quality,quality==8 & (f1.sugar.level=="L"))
```


```{r,echo=FALSE, message=FALSE, warning=FALSE, quality_sweetness}

ggplot(data = subset(wine_quality,!is.na(f1.sugar.level)),
       aes(quality, fill = f1.sugar.level)) +
       geom_bar(position = "dodge") +
       facet_wrap( ~ wine.type) +
       coord_cartesian(xlim = c(3, 9)) +
       ggtitle("Quality distribution across sugar levels") +
       scale_fill_brewer(palette = 'Reds',
       guide = guide_legend(title = "Sugar Level")) +
       theme_dark() +
       theme(plot.title = element_text(hjust = 0.5))
       
```

Most of the white wine samples have high concentration of sugar at nearly all quality levels :3,4,5,6,7,8 .White wine seems to be inclined towards sweetness.
Similarly red wine also has V.H concentration of sugar for the same set of quality levels as white wine however,with way lower count than  samples at L and M level of sugar.
We had seen marginal linear increase in RS level with increase in quality after grouping quality levels. This increase is contributed by white wine sweeetness.We can infer here that generally white wines are sweeter than red wine.

Below plots analyse how residual sugar works with  other chemicals-

```{r echo=FALSE, message=FALSE, warning=FALSE,SO2}

grid.arrange(
  ggplot(wine_quality, aes(x = residual.sugar, y = total.sulfur.dioxide)) +
  geom_point(
  alpha = 0.5,
  position = "jitter",
  size = 0.75
  ) +
  geom_smooth(method = "lm", color = "blue") +
  xlab("Residual Sugar (g / dm^3)") +
  ylab("total sulfur dioxide \
  (mg / dm^3)"),
  
  ggplot(wine_quality, aes(x = residual.sugar, y = free.sulfur.dioxide)) +
  geom_point(
  alpha = 0.5,
  position = "jitter",
  size = 0.75
  ) +
  geom_smooth(method = "lm", color = "blue") +
  xlab("Residual Sugar (g / dm^3)") +
  ylab("free sulfur dioxide\
  (mg / dm^3)"),
  ncol = 1
  )
  
```


RS level increases linearly with increase in both free and total SO2(free SO2 is a compoenent of total SO2).


```{r echo=FALSE, message=FALSE, warning=FALSE,FA_RS }

grid.arrange(
  ggplot(wine_quality, aes(x = residual.sugar, y = fixed.acidity)) +
  geom_point(
  alpha = 0.5,
  position = "jitter",
  size = 0.75
  ) +
  geom_smooth(method = "lm") +
  xlab("Residual Sugar (g / dm^3)") +
  ylab("fixed acidity \n       (tartaric acid - g / dm^3)"),
  
  ggplot(wine_quality, aes(x = residual.sugar, y = volatile.acidity)) +
  geom_point(
  alpha = 0.5,
  position = "jitter",
  size = 0.75
  ) +
  geom_smooth(method = "lm", color = "blue") +
  xlab("Residual Sugar (g / dm^3)") +
  ylab("volatile acidity\n     (acetic acid - g / dm^3)"),
  ncol = 1
  )

```


Total acidity (sum of fixed and volatile acidity) decreases with increase in RS concentration.


```{r echo=FALSE, message=FALSE, warning=FALSE,salts_citric_acid}

grid.arrange(
  ggplot(wine_quality, aes(x = residual.sugar, y = citric.acid)) +
    geom_point(
      alpha = 0.5,
      position = "jitter",
      size = 0.75
    ) +
    geom_smooth(method = "lm") +
    xlab("Residual Sugar (g / dm^3)") +
    ylab("Citric Acid (g / dm^3)"),
  
  ggplot(wine_quality, aes(x = residual.sugar, y = chlorides)) +
    geom_point(
      alpha = 0.5,
      position = "jitter",
      size = 0.75
    ) +
    geom_smooth(method = "lm") +
    xlab("Residual Sugar (g / dm^3)") +
    ylab("Chlorides (sodium chloride - g / dm^3)"),
  ncol = 1
)

```

Chloride levels declines as it is balanced by increasing rs levels.

Citric acid level increases to balance the increasing sweetness.


```{r echo=FALSE, message=FALSE, warning=FALSE,Sulphates_pH}

grid.arrange(
  ggplot(wine_quality, aes(x = residual.sugar, y = sulphates)) +
  geom_point(
  alpha = 0.5,
  position = "jitter",
  size = 0.75
  ) +
  geom_smooth(method = "lm") +
  xlab("Residual Sugar (g / dm^3)") +
  ylab("Sulphates\n(potassium sulphate - g / dm3)"),
  
  ggplot(wine_quality, aes(x = residual.sugar, y = pH)) +
  geom_point(
  alpha = 0.5,
  position = "jitter",
  size = 0.75
  ) +
  geom_smooth(method = "lm") +
  xlab("Residual Sugar (g / dm^3)") +
  ylab("pH"),
  ncol = 1
  )

```

pH and sulpahte levels decline with increase  in RS levels.


```{r echo=FALSE, message=FALSE, warning=FALSE, alcohol_density}
grid.arrange(
  ggplot(wine_quality, aes(x = residual.sugar, y = alcohol)) +
  geom_point(
  alpha = 0.5,
  position = "jitter",
  size = 0.75
  ) +
  geom_smooth(method = "lm") +
  xlab("Residual Sugar (g / dm^3)") +
  ylab("Alcohol (% by volume)"),
  
  ggplot(wine_quality, aes(x = residual.sugar, y = density)) +
  geom_point(
  alpha = 0.5,
  position = "jitter",
  size = 0.75
  ) +
  geom_smooth(method = "lm") +
  xlab("Residual Sugar (g / dm^3)") +
  ylab("Density (g / cm^3)"),
  ncol = 1
  )
  
```


RS contributes to density.Since most of inherent sugar gets converted to alcohol,alcohol also contributes to sweetness.We wouldnt want both the components increasing.At higher RS levels,alcohol required is low.

# Bivariate Analysis

The correlation coefficient between quality and residual sugar is 0. The distribution of quality ratings for different sugar levels shows all sugar levels across quality ratings without a clear pattern.On grouping the quality levels  against residual sugar we see a marginal increase of RS levels at increasing  quality levels.

Total acidity(volatile acidity+fixed acidity)  and pH levels decrease at higher levels of residual sugar, especilaly volatile acidity level and pH.

Toatal sulphur di oxide(inclusive of free SO2) and sulphate levels decline at higher RS levels.Sulphites release SO2 which combines with RS to form bound SO2.Wines  inherently have some amount of SO2.

Higher RS will need higher citric acid (mariginal linear increase) to combat sweetness with freshness and flavour.

Chlorides levels decline at higher RS levels,reducing saltiness.

RS contributes to density.Since most of inherent sugar gets converted to alcohol during fermentation,alcohol also contributes to sweetness.At higher RS levels,alcohol required is low so as not to overload wines with sweetness.

From the plots,observations and correlation coefficient(0.55) we see that residual sugar has the strongest relationship with total sulphur di oxide.


# Multivariate Plots

Investigating the behavior of residual sugar with other chemicals further,we will now consider how the samples of varied sugar levels for both red and white wines are distributed against quality.

```{r echo=FALSE, message=FALSE, warning=FALSE,quality_residual.sugar}
ggplot(
  data = subset(wine_quality,!is.na(f1.sugar.level)),
  aes(y = quality, x = residual.sugar, color = f1.sugar.level)
  ) +
  geom_point(alpha = 0.5,
  position = "jitter",
  size = 1) +
  geom_smooth(method = "lm", color = "yellow") +
  scale_color_brewer(type = "qual", palette = 2) +
  facet_wrap( ~ wine.type) +
  xlim(
  quantile(wine_quality$residual.sugar, prob = .1),
  quantile(wine_quality$residual.sugar, prob = .99)
  ) +
  ylim(quantile(wine_quality$quality, prob = 0),
  quantile(wine_quality$quality, prob = .99)) +
  geom_hline(
  yintercept = mean(wine_quality$quality),
  linetype = "longdash",
  alpha = .5,
  color = "blue"
  ) +
  geom_vline(
  xintercept = mean(wine_quality$residual.sugar),
  linetype = "longdash",
  color = "blue",
  alpha = .5
  ) +
  scale_color_brewer(
  type = "seq",
  palette = 'Reds',
  guide = guide_legend(title = "Sugar Level",
  override.aes = list(alpha = 1, size = 2))
  ) +
  facet_wrap( ~ wine.type) +
  theme_dark()+
  xlab('residual sugar (g / dm^3)')
 
```

Red wine samples have very low concentration of V.H sugar(> 5.7 g / dm^3).Even the H concentration is within 5 g / dm^3.More H level samples are packed at < 4 g / dm^3.We see V.H Sugar level at quality 7.Note there are fewer data points at Q-8.Quality improves marginally at higher RS levels.

White wine samples have high samples with V.H sugar levels.Even the H sugar levels are scattered at levels >4 g / dm^3.There are v.H sugar levels  high quality levels(7,8) and also low quality levels(3,4).Quality drops marginally at higher RS levels.

Red wines are less sweeter than White wines.

```{r echo=FALSE, message=FALSE, warning=FALSE,quality_alcohol}

ggplot(data = subset(wine_quality,!is.na(f1.sugar.level)),
       aes(y = quality, x = alcohol, color = f1.sugar.level)) +
       geom_point(alpha = 0.5,
       position = "jitter",
       size = 1) +
       geom_smooth(method = "lm", color = "yellow") +
       facet_wrap( ~ wine.type) +
       xlim(quantile(wine_quality$alcohol, prob = .1),
       quantile(wine_quality$alcohol, prob = .99)) +
       ylim(quantile(wine_quality$quality, prob = 0),
       quantile(wine_quality$quality, prob = .99)) +
       geom_hline(
       yintercept = mean(wine_quality$quality),
       linetype = "longdash",
       alpha = .5,
       color = "blue"
       ) +
       geom_vline(
       xintercept = mean(wine_quality$alcohol),
       linetype = "longdash",
       color = "blue",
       alpha = .5
       ) +
       scale_color_brewer(
       type = "seq",
       palette = 'Reds',
       guide = guide_legend(title = "Sugar Level",
       override.aes = list(alpha = 1, size = 2))
       ) +
       facet_wrap( ~ wine.type) +
       theme_dark()+
  xlab('alcohol (% by volume)')
       
```


% Alcohol by volume  tends to increase linearly with quality in both red and white wine samples.
Since alcohol already has some amount of sweetness and we know red wines are less sweet than white wine,we donot see V.H sugar levels in red wine.
In white wine samples, V.H sugar level samples are concentrated at alcohol level below 10.5% and decreases thereafter with lower sugar level samples increasing after 10.5% alcohol. 
% Alcohol by volume increases with decrease in RS levels.


```{r echo=FALSE, message=FALSE, warning=FALSE,quality_total.sulfur.dioxide}
ggplot(
  data = subset(wine_quality,!is.na(f1.sugar.level)),
  aes(y = quality, x = total.sulfur.dioxide, color = f1.sugar.level)
  ) +
  geom_point(alpha = 0.5,
  position = "jitter",
  size = 1) +
  geom_smooth(method = "lm", color = "yellow") +
  xlim(
  quantile(wine_quality$total.sulfur.dioxide, prob = .1),
  quantile(wine_quality$total.sulfur.dioxide, prob = .99)
  ) +
  ylim(quantile(wine_quality$quality, prob = 0),
  quantile(wine_quality$quality, prob = .99)) +
  geom_hline(
  yintercept = mean(wine_quality$quality),
  linetype = "longdash",
  alpha = .5,
  color = "blue"
  ) +
  geom_vline(
  xintercept = mean(wine_quality$total.sulfur.dioxide),
  linetype = "longdash",
  color = "blue",
  alpha = .5
  ) +
  scale_color_brewer(
  type = "seq",
  palette = 'Reds',
  guide = guide_legend(title = "Sugar Level",
  override.aes = list(alpha = 1, size = 2))
  ) +
  facet_wrap( ~ wine.type) +
  theme_dark()+
  xlab("total sulfur dioxide (mg / dm^3)")

```

Higher Total sulphur di oxide  levels lowers quality level in both red wine and white wine.
Total SO2 is maintained at small concentration in wine.Total SO2 is < 150 mg / dm^3 in red wine.
Note that more the RS level, greater SO2 is need,since red wine has lower RS concentration, small amounts of SO2 is needed. 

White wines tends to have large total SO2 levels > 200 mg / dm^3.We can see that V.H sugar levels concentration is at higher SO2 levels.More SO2 is needed to react with RS to form bound SO2 which is a component of total SO2 and this leaves more free SO2 increasing SO2 levels.


```{r echo=FALSE, message=FALSE, warning=FALSE,quality_free.sulfur.dioxide}

ggplot(
  data = subset(wine_quality,!is.na(f1.sugar.level)),
  aes(y = quality, x = free.sulfur.dioxide, color = f1.sugar.level)
  ) +
  geom_point(alpha = 0.5,
  position = "jitter",
  size = 1) +
  geom_smooth(method = "lm", color = "yellow") +
  xlim(
  quantile(wine_quality$free.sulfur.dioxide, prob = .1),
  quantile(wine_quality$free.sulfur.dioxide, prob = .99)
  ) +
  ylim(quantile(wine_quality$quality, prob = 0),
  quantile(wine_quality$quality, prob = .99)) +
  geom_hline(
  yintercept = mean(wine_quality$quality),
  linetype = "longdash",
  alpha = .5,
  color = "blue"
  ) +
  geom_vline(
  xintercept = mean(wine_quality$free.sulfur.dioxide),
  linetype = "longdash",
  color = "blue",
  alpha = .5
  ) +
  scale_color_brewer(
  type = "seq",
  palette = "Reds",
  guide = guide_legend(title = "Sugar Level",
  override.aes = list(alpha = 1, size = 2))
  ) +
  facet_wrap( ~ wine.type) +
  theme_dark()+
  xlab("free sulfur dioxide (mg / dm^3)")

```


Free sulphur di oxide has less impact on quality, in the sense free SO2 level is maintained in a balanced manner.Free SO2 is necessary to prevent oxidation and to increase shelf life.In white wines, due to higher sweetness level, there is a negligeble increase in free SO2 at under Q-6 level while there is negligible decrease in free SO2 in red wine, due to lower RS.


```{r echo=FALSE, message=FALSE, warning=FALSE,quality_fixed.acidity}

ggplot(
  data = subset(wine_quality,!is.na(f1.sugar.level)),
  aes(y = quality, x = fixed.acidity, color = f1.sugar.level)
  ) +
  geom_point(
  alpha = 0.5,
  position = "jitter",
  size = 1,
  aes(color = f1.sugar.level)
  ) +
  geom_smooth(method = "lm", color = "yellow") +
  xlim(
  quantile(wine_quality$fixed.acidity, prob = .1),
  quantile(wine_quality$fixed.acidity, prob = .99)
  ) +
  ylim(quantile(wine_quality$quality, prob = 0),
  quantile(wine_quality$quality, prob = .99)) +
  geom_hline(
  yintercept = mean(wine_quality$quality),
  linetype = "longdash",
  alpha = .5,
  color = "blue"
  ) +
  geom_vline(
  xintercept = mean(wine_quality$fixed.acidity),
  linetype = "longdash",
  color = "blue",
  alpha = .5
  ) +
  scale_color_brewer(
  type = "seq",
  palette = "Reds",
  guide = guide_legend(title = "Sugar Level",
  override.aes = list(alpha = 1, size = 2))
  ) +
  facet_wrap(~ wine.type) +
  theme_dark()+
  xlab("fixed acidity (tartaric acid - g / dm^3) ")

```

Fixed acidity level is higher in red wine than white wine. Red wine has fixed acidity (tartaric acid) at levels > 12 g / dm^3  while white wine has <10 g / dm^3 most of which is packed under 8 g / dm^3.Red wine quality imporves with increase in fixed acidity while white wine quality decreases.

```{r echo=FALSE, message=FALSE, warning=FALSE,quality_volatile.acidity}

ggplot(
  data = subset(wine_quality,!is.na(f1.sugar.level)),
  aes(x = volatile.acidity, y = quality, color = f1.sugar.level)
  ) +
  geom_point(alpha = 0.5,
  size = 1,
  position = "jitter") +
  geom_smooth(method = "lm", color = "yellow") +
  xlim(
  quantile(wine_quality$volatile.acidity, prob = .1),
  quantile(wine_quality$volatile.acidity, prob = .99)
  ) +
  ylim(quantile(wine_quality$quality, prob = 0),
  quantile(wine_quality$quality, prob = .99)) +
  geom_hline(
  yintercept = mean(wine_quality$quality),
  linetype = "longdash",
  alpha = .5,
  color = "blue"
  ) +
  geom_vline(
  xintercept = mean(wine_quality$volatile.acidity),
  linetype = "longdash",
  color = "blue",
  alpha = .5
  ) +
  scale_color_brewer(
  type = "seq",
  palette = "Reds",
  guide = guide_legend(title = "Sugar Level",
  override.aes = list(alpha = 1, size = 2))
  ) +
  facet_wrap( ~ wine.type) +
  theme_dark() +
  xlab("volatile acidity (acetic acid - g / dm^3) ")

```

Volatile acidity defines the amount of acetic acid.High acetic acid content affects taste.Acetic acid level is higher  in red wine compared to  white wine and also affects quality:quality drops at higher acetic acid concentration.High volatile acidity contributes to wine faults.

```{r echo=FALSE, message=FALSE, warning=FALSE,quality_citric_acid}

ggplot(data = subset(wine_quality,!is.na(f1.sugar.level)),
       aes(x = citric.acid, y = quality, color = f1.sugar.level)) +
       geom_point(alpha = 0.5,
       size = 1,
       position = "jitter") +
       geom_smooth(method = "lm", color = "yellow") +
       xlim(
       quantile(wine_quality$citric.acid, prob = .1),
       quantile(wine_quality$citric.acid, prob = .99)
       ) +
       ylim(quantile(wine_quality$quality, prob = 0),
       quantile(wine_quality$quality, prob = .99)) +
       geom_hline(
       yintercept = mean(wine_quality$quality),
       linetype = "longdash",
       alpha = .5,
       color = "blue"
       ) +
       geom_vline(
       xintercept = mean(wine_quality$citric.acid),
       linetype = "longdash",
       color = "blue",
       alpha = .5
       ) +
       scale_color_brewer(
       type = "seq",
       palette = "Reds",
       guide = guide_legend(title = "Sugar Level",
       override.aes = list(alpha = 1, size = 2))
       ) +
       facet_wrap( ~ wine.type) +
       theme_dark() +
       xlab("citric acid (g / dm^3) ")

```

Citric acid adds freshness.Most of white wine samples have  citric acid level concentrated at values > 0.2 g/dm^3 and < 0.4 g/dm^3 while most red wine samples have citric acid content distributed from 0.05 g/dm^3 to 0.5 g/dm^3  .Quality improves with increase in citric acid levels in red wine while quality declines negligibly at higher citric acid levels in white wine.


```{r echo=FALSE, message=FALSE, warning=FALSE,quality_chlorides}

ggplot(data = subset(wine_quality,!is.na(f1.sugar.level)),
       aes(x = chlorides, y = quality, color = f1.sugar.level)) +
       geom_point(alpha = 0.5,
       size = 1,
       position = "jitter") +
       geom_smooth(method = "lm", color = "yellow") +
       xlim(
       quantile(wine_quality$chlorides, prob = .1),
       quantile(wine_quality$chlorides, prob = .99)
       ) +
       ylim(quantile(wine_quality$quality, prob = 0),
       quantile(wine_quality$quality, prob = .99)) +
       geom_hline(
       yintercept = mean(wine_quality$quality),
       linetype = "longdash",
       alpha = .5,
       color = "blue"
       ) +
       geom_vline(
       xintercept = mean(wine_quality$chlorides),
       linetype = "longdash",
       color = "blue",
       alpha = .5
       ) +
       scale_color_brewer(
       type = "seq",
       palette = "Reds",
       guide = guide_legend(title = "Sugar Level",
       override.aes = list(alpha = 1, size = 2))
       ) +
       facet_wrap(~ wine.type) +
       theme_dark() +
       xlab("chlorides (sodium chloride - g / dm^3) ")

```


Chloride level is higher in red wine compared to white wine samples.While most white wine samples are concentrated at just under 0.05 g / dm^3 of sodium chloride, red wine samples are concentrated at values > 0.08  g / dm^3 of sodium chloride.Lower chloride levels improves quality for both red and white wine samples.

```{r echo=FALSE, message=FALSE, warning=FALSE,quality_density}

ggplot(data = subset(wine_quality,!is.na(f1.sugar.level)),
       aes(x = density, y = quality, color = f1.sugar.level)) +
       geom_point(alpha = 0.5,
       size = 1,
       position = "jitter") +
       geom_smooth(method = "lm", color = "yellow") +
       xlim(quantile(wine_quality$density, prob = .1),
       quantile(wine_quality$density, prob = .99)) +
       ylim(quantile(wine_quality$quality, prob = 0),
       quantile(wine_quality$quality, prob = .99)) +
       geom_hline(
       yintercept = mean(wine_quality$quality),
       linetype = "longdash",
       alpha = .5,
       color = "blue"
       ) +
       geom_vline(
       xintercept = mean(wine_quality$density),
       linetype = "longdash",
       color = "blue",
       alpha = .5
       ) +
       scale_color_brewer(
       type = "seq",
       palette = "Reds",
       guide = guide_legend(title = "Sugar Level",
       override.aes = list(alpha = 1, size = 2))
       ) +
       facet_wrap( ~ wine.type) +
       theme_dark() +
       xlab("density (g / cm^3) ")

```

Lower density improves quality marginally for both the wine types.Most of red wine samples have high density at values > 0.995 g / cm^3.White wine samples with V.H sugar level  have high density at levels > 0.995. RS contributes to density.


```{r echo=FALSE, message=FALSE, warning=FALSE,quality_pH }

ggplot(data = subset(wine_quality, !is.na(f1.sugar.level)),
       aes(x = pH, y = quality, color = f1.sugar.level)) +
       geom_point(alpha = 0.5,
       size = 1,
       position = "jitter") +
       geom_smooth(method = "lm", color = "yellow") +
       xlim(quantile(wine_quality$pH, prob = .1),
       quantile(wine_quality$pH, prob = .99)) +
       ylim(quantile(wine_quality$quality, prob = 0),
       quantile(wine_quality$quality, prob = .99)) +
       geom_hline(
       yintercept = mean(wine_quality$quality),
       linetype = "longdash",
       alpha = .5,
       color = "blue"
       ) +
       geom_vline(
       xintercept = mean(wine_quality$pH),
       linetype = "longdash",
       color = "blue",
       alpha = .5
       ) +
       scale_color_brewer(
       type = "seq",
       palette = "Reds",
       guide = guide_legend(title = "Sugar Level",
       override.aes = list(alpha = 1, size = 2))
       ) +
       facet_wrap( ~ wine.type) +
       theme_dark() +
       xlab("pH ")

```

Most of the wine samples have pH levels in range of 3-3.8 Quality drops marginally for increasing  pH for red wine while it improves for white wine which makes sense as white wine has more sweetness to be balanced.

```{r echo=FALSE, message=FALSE, warning=FALSE,quality_sulphates}

ggplot(data = subset(wine_quality,!is.na(f1.sugar.level)),
       aes(x = sulphates, y = quality, color = f1.sugar.level)) +
       geom_point(alpha = 0.5,
       size = 1,
       position = "jitter") +
       geom_smooth(method = "lm", color = "yellow") +
       xlim(
       quantile(wine_quality$sulphates, prob = .1),
       quantile(wine_quality$sulphates, prob = .99)
       ) +
       ylim(quantile(wine_quality$quality, prob = 0),
       quantile(wine_quality$quality, prob = .99)) +
       geom_hline(
       yintercept = mean(wine_quality$quality),
       linetype = "longdash",
       alpha = .5,
       color = "blue"
       ) +
       geom_vline(
       xintercept = mean(wine_quality$sulphates),
       linetype = "longdash",
       color = "blue",
       alpha = .5
       ) +
       scale_color_brewer(
       type = "seq",
       palette = "Reds",
       guide = guide_legend(title = "Sugar Level",
       override.aes = list(alpha = 1, size = 2))
       ) +
       facet_wrap(~ wine.type) +
       theme_dark() +
       xlab("sulphates (potassium sulphate - g / dm^3) ")

```

Sulpahtes improve quality linearly for both red and white wine more so for red wine.Sulphates produce SO2 which is used by RS (higher in white wine) to form bound SO2.For the same quantity of sulphates added, quality impact  is strongly visible as they have less rs to bind to.


# Multivariate Analysis

In sum,we see all these chemical properties affect each other wherein some of the properties are kept in balance by the other properties.An equillibrium is maintained by the interplay of these chemicals so as to produce a  sensory pleasing quality of flavors.

Chlorides are maintained at a lower level as we cannot have salty wines.
Alcohol level is on the higher side in High quality wines and this in turn affects density which gets lowered.White wine samples which donot have High sugar content have higher alcohol %.

Total sulphur di oxide is on the higher side in High quality wines so is free sulphur di oxide, one of the components of total SO2 (bound sulphur di oxide is the other component).This is necessary to maintain shelf life, it being anti bacterial and anti oxident.Besides, being produced in the wines during fermentation, additives are added in the form of sulphates(should be read as sulphites) to increase SO2.Hence we see slightly higher levels of sulpahtes at higher  quality levels.It also influences acidity with lower 

Median Residual sugar(RS) level increases marginally with quality. RS reacts with SO2 to form bound SO2(part of total SO2) reducing free SO2.More free SO2 is needed(we see it increase linearly with quality) to prevent oxidation. RS also reacts with acidity and pH to balance sweetness level(s).% Alcohol by volume decreases at higher RS levels.

Quality drops marginally for white wine at V.H sugar level  which makes sense as white wine has more sweetness to be balanced at V.H level.While for red wine, RS being on  lower side would do well with RS as quality improves with marginal increase in RS.

Higher citric acid contributes to better quality especially in red wine while has negligible  negative effect on quality in white wine samples.

Fixed acidity and volatile acidity together form total acidity.Lower tartaric acid at higher quality level is observed in white wine.Increase in tartaric acid affects quality negatively in white wine samples.Higher fixed acidity in red wines improves the quality.

# Final Plots and Summary

### Quality distribution across residual sugar levels
```{r echo=FALSE,message=FALSE, warning=FALSE, Plot_Two}

ggplot(data = subset(wine_quality,!is.na(f1.sugar.level)),
       aes(quality, fill = f1.sugar.level)) +
       geom_bar(position = "dodge") +
       facet_wrap( ~ wine.type) +
       # coord_cartesian(xlim = c(3, 9)) +
       ggtitle("Quality distribution across sugar levels") +
       scale_fill_brewer(palette = 'Reds', 
       guide = guide_legend(title = "Sugar Level")) +
       theme_dark() +
       ggtitle("Quality and RS levels across red and wine wine samples") +
       theme(plot.title = element_text(hjust = 0.5)) +
       xlab('Quality ratings') +
       ylab('Sample count')
       
```

From the correlation plot, we know that quality and residual sugar share non linear relationship with a correlation coefficient of 0.This warrants more exploration  to understand how residual sugar impacts or doesnt impact quality.In the above plot,we see different levels of sugar  interspersed at all quality levels :low level of sugar at quality >6 and also at <5 and high level of sugar at quality >6 and also at <5. 

Most of the white wine samples have high concentration of sugar at nearly all quality levels :3,4,5,6,7,8 indicating white wine seems to be inclined towards sweetness.
Similarly red wine also has V.H concentration of sugar at same set of levels as white wine however,with higher number of samples at L and M level of sugar.
This forms the basis for further exploration of sugar levels and their interation with other properties.


### Residual Sugar effect on Quality

```{r echo=FALSE,message=FALSE, warning=FALSE, Plot_One}

ggplot(data = subset(wine_quality, !is.na(f1.sugar.level)),
       aes(x = f2_quality, y = residual.sugar)) +
       geom_jitter(alpha = 0.5,
       color = 'orange',
       size = 1) +
       scale_color_brewer(type = 'seq',
       palette = 'Reds') +
       geom_boxplot(alpha = 0.1, color = 'brown') +
       ylim(
       quantile(wine_quality$residual.sugar, prob = 0.1),
       quantile(wine_quality$residual.sugar, prob = 0.99)
       ) +
       #facet_wrap( ~ wine.type) +
       ggtitle('Residual Sugar effect on Quality') +
       theme_dark() +
       theme(plot.title = element_text(hjust = 0.5)) +
       xlab('Quality levels') +
       ylab('Residual sugar (g / dm^3)')
       
```


In the bivariate analysis of residual sugar vs quality, quality ratings have been categorized to three levels : Low(Q-3,Q-4) ,Avg(Q-5,Q-6) and High(Q-7,Q-8,Q-9).
We see a marginal increase in the RS levels at increasing quality levels. Would this negligible increase impact quality?


###  % ABV and Residual Sugar levels 
```{r echo=FALSE,message=FALSE, warning=FALSE, Plot_Three}

ggplot(data = subset(wine_quality,!is.na(f1.sugar.level)),
       aes(y = quality, x = alcohol, color = f1.sugar.level)) +
       geom_point(alpha = 0.5,
       position = "jitter",
       size = 1) +
       geom_smooth(method = "lm", color = "yellow") +
       facet_wrap( ~ wine.type) +
       xlim(quantile(wine_quality$alcohol, prob = .1),
       quantile(wine_quality$alcohol, prob = .99)) +
       ylim(quantile(wine_quality$quality, prob = 0),
       quantile(wine_quality$quality, prob = .99)) +
       geom_hline(
       yintercept = mean(wine_quality$quality),
       linetype = "longdash",
       alpha = .5,
       color = "blue"
       ) +
       geom_vline(
       xintercept = mean(wine_quality$alcohol),
       linetype = "longdash",
       color = "blue",
       alpha = .5
       ) +
       scale_color_brewer(
       type = "seq",
       palette = "Reds",
       guide = guide_legend(title = "Sugar Level",
       override.aes = list(alpha = 1, size = 2))
       ) +
       facet_wrap( ~ wine.type) +
       theme_dark() +
       ggtitle("Impact on Quality by % ABV and Residual Sugar") +
       xlab("alcohol (% by volume)")+
       theme(plot.title = element_text(hjust = 0.5)) 

```

This multivariate plot considers a third variable,alcohol which has the highest correlation coefficient of 0.46 with the response variable, quality with distribution of sugar levels in the background.Selection of sugar level(residual sugar) is relevant in the sense that RS has non linear relationship with quality.

% Alcohol by volume  tends to increase linearly with quality in both red and white wine samples.
Since alcohol already has some amount of sweetness due to sugar coverting to alcohol during fermentation and leaving behind residual sugar,we know red wines are less sweet than white wine. We donot see V.H sugar level concentration in red wine like that of white wine.In white wine, V.H sugar level is present at low alcohol %. With decline RS levels  we see increase in alcohol levels. Red wine samples with lower Rs levels see increase in Quality with increase in alcohol %.

With the introduction of third variable we see how RS contributes to quality.This is one such example of the influence of a third variable on RS and their effect on quality. Going over the RS level impact on quality for different chemical properties analysed  under 'Multivariate Analysis', we see how RS interacts with other properties contributing to quality.


# Reflection

Per French oenologist, Emile Peynaud: 'The quality of a wine is the totality of its properties, that is to say the properties which render it acceptable or desirable.'
In effect it is the totally subjective pleasure provided by drinking the wine which conditions judgment ... Quality only exists in relation to this individual and then
only in as far as he has the ability to perceive it and approve it.
(Peynaud, 1987 p. 220).

All of the physiochemical properties provided were required to understand the interactions between each of them. We are determing 'Quality' which is a sensory perception using physiochemical properties  that exhibit complex interactions to produce the desired flavors.That being said, by making available the category of flavors,a sensory preference or a profile which maps the quality,  analysing the interactions would have been fruitful.The data that is made available has fewer to nil lower and superior wine data which could have added weight to data analysis.

The corrplot was crucial to understand the interactions of the chemicals which required further research emphasizing  the need to understand the basics of the domain atleast from the data perspective in order to perform effective analysis.Another area which required a lot of effort was in visualizing the interations-how best to capture the not so obvious relationship between the variables which can be  telling.


# References

http://www.gencowinemakers.com/docs/Acids%20Presentation.pdf
http://www.sthda.com/english/wiki/be-awesome-in-ggplot2-a-practical-guide-to-be-highly-effective-r-software-and-data-visualization
http://www.winesofbalkans.com/sulphur-dioxide-so2-the-single-most-useful-additive-in-the-winemaking-process.html
http://www.scielo.br/pdf/bpsr/v7n1/02.pdf


